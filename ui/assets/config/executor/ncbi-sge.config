// This is an example of SGE executor configuration
// It is specific for internal NCBI use, you need to supply -P and -A parameters specific to your HPC
// account. Keep -V, maybe adjust osverfull parameters (set to use Alma Linux 8)
// This configuration uses binaries setup directly on network accessible drive. We currently don't support
// such configurations for third party, use docker or singularity for this. Uncomment corresponding line below
//docker.enabled = true
//singularity.enabled = true

env {
    GP_HOME="/netmnt/vast01/egapx/bin/"
    PATH = "/netmnt/vast01/egapx/bin/gp:/netmnt/vast01/egapx/bin/third-party/sratoolkit.3.0.7-ubuntu64/bin/:/netmnt/vast01/egapx/bin/third-party/STAR/bin/Linux_x86_64:\$PATH"
    DEBUG_STACK_TRACE_LEVEL="Warning"
    EXCEPTION_STACK_TRACE_LEVEL="Warning"
    DIAG_POST_LEVEL="Trace"
    DEBUG_CATCH_UNHANDLED_EXCEPTIONS="0"
    DEBUGINFOD_URLS="/dev/null"

// these turn off connecting to local NCBI services, it can simulate running without certain network access
// CONN_DISPD_DISABLE="1"
// CONN_LBSMD_DISABLE="1"
}

process {
    executor = 'sge'
    memory = 60.GB
    time = 6.h
    errorStrategy = 'retry'
    maxRetries = 3
    // We can't request SGE 'slots' ('cpus' directive) but we need to pass the number of available threads
    // to underlying process to run it correctly. We use 'ext.cpus' for this and use clusterOptions to allocate
    // large enough instance via m_thread
    ext.cpus = 7
    clusterOptions = "-m n -V -P progressive -w n -A annotations-euk -l express=TRUE,h_vmem=INFINITY,m_thread=8,osverfull='8*'"

    withLabel: 'big_job' {
        memory = 120.GB
        ext.cpus = 15
        clusterOptions = "-m n -V -P progressive -w n -A annotations-euk -l express=TRUE,h_vmem=INFINITY,m_thread=16,osverfull='8*'"
    }

    withLabel: 'huge_job' {
        memory = 200.GB
        ext.cpus = 31
        clusterOptions = "-m n -V -P progressive -w n -A annotations-euk -l express=TRUE,h_vmem=INFINITY,m_thread=32,osverfull='8*'"
    }

    withLabel: 'long_job' {
        time = 16.h
    }
}
